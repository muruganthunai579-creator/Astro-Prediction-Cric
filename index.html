<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Astro Football – Panchapakshi Predictor</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <style>
    :root {
      --home-main:#0ea5e9;
      --away-main:#22c55e;
      --bg:#020617;
      --card:#020b1d;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#0f172a,#020617 60%);
      color:#e5e7eb;
    }
    .wrap{max-width:960px;margin:0 auto;padding:12px;}
    h1{
      font-size:16px;
      letter-spacing:.28em;
      text-transform:uppercase;
      color:#9ca3af;
      margin:6px 0 10px;
      text-align:center;
    }
    .card{
      background:linear-gradient(145deg,#02081a,#020617);
      border-radius:18px;
      border:1px solid rgba(148,163,184,.25);
      padding:12px;
      margin-bottom:12px;
      box-shadow:0 24px 60px rgba(15,23,42,.7);
    }
    .card-title{
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.2em;
      color:#9ca3af;
      margin-bottom:6px;
    }
    label{
      display:block;
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:.16em;
      color:#6b7280;
      margin-bottom:2px;
    }
    input,select{
      width:100%;
      border-radius:10px;
      border:1px solid #1f2937;
      background:#020617;
      color:#e5e7eb;
      font-size:13px;
      padding:7px 10px;
      margin-bottom:8px;
    }
    input:focus,select:focus{
      outline:none;
      border-color:#38bdf8;
      box-shadow:0 0 0 1px #38bdf8;
    }
    button{
      width:100%;
      border:none;
      border-radius:999px;
      padding:9px;
      font-size:11px;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:.18em;
      color:white;
      cursor:pointer;
      margin-top:2px;
    }
    .btn-main{
      background:linear-gradient(90deg,#22c55e,#14b8a6);
      box-shadow:0 8px 20px rgba(34,197,94,.45);
    }
    .btn-secondary{
      background:linear-gradient(90deg,#38bdf8,#6366f1);
      box-shadow:0 8px 20px rgba(56,189,248,.45);
    }
    .btn-small{
      padding:6px 10px;
      width:auto;
      font-size:10px;
    }
    button:active{transform:scale(.97);}
    .row{display:flex;gap:8px;flex-wrap:wrap;}
    .row>div{flex:1;min-width:0;}
    .tiny{
      font-size:11px;
      color:#9ca3af;
      margin-top:4px;
      line-height:1.5;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:11px;
      margin-top:4px;
    }
    th,td{
      border:1px solid #111827;
      padding:4px 5px;
      text-align:left;
    }
    th{
      background:#020617;
      color:#9ca3af;
      text-transform:uppercase;
      letter-spacing:.12em;
      font-size:9px;
    }
    tr:nth-child(even){background:#020617;}
    tr:nth-child(odd){background:#02081a;}
    tr:hover{background:#0f172a;cursor:pointer;}
    .tag{
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:.12em;
      font-weight:600;
      margin-right:4px;
    }
    .tag-api{background:#022c22;color:#4ade80;}
    .tag-day{background:#082f49;color:#38bdf8;}
    .tag-overall{background:#422006;color:#facc15;}
    .team-home{color:var(--home-main);font-weight:600;}
    .team-away{color:var(--away-main);font-weight:600;}

    .bar-wrap{
      width:100%;
      height:14px;
      border-radius:999px;
      overflow:hidden;
      border:1px solid #1f2937;
      background:#020617;
      margin:6px 0 4px 0;
      position:relative;
      display:flex;
    }
    .bar-fill-home{
      background:linear-gradient(90deg,var(--home-main),#38bdf8);
      height:100%;
    }
    .bar-fill-away{
      background:linear-gradient(90deg,var(--away-main),#22c55e);
      height:100%;
    }
    .bar-label{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      font-size:10px;
      font-weight:600;
      white-space:nowrap;
      text-shadow:0 1px 2px rgba(0,0,0,.7);
    }
    .excellent{color:#4ade80;font-weight:700;}
    .weak{color:#f97316;font-weight:600;}
    .danger{color:#f97316;}
    .good{color:#22c55e;}
    .draw{color:#e5e7eb;font-weight:600;}
    .badge{
      display:inline-block;
      padding:2px 7px;
      border-radius:999px;
      font-size:10px;
      border:1px solid #1f2937;
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>ASTRO FOOTBALL • PANCHAPAKSHI</h1>

  <!-- API: LIVE / UPCOMING MATCHES -->
  <div class="card">
    <div class="card-title">Step 1 · Load Football Matches (API-FOOTBALL)</div>
    <div class="row">
      <div>
        <label>API Key (api-football.com)</label>
        <input id="apiKey" placeholder="Paste your API key here" />
      </div>
      <div>
        <label>Matches</label>
        <select id="apiFilter">
          <option value="live" selected>Live</option>
          <option value="next">Upcoming</option>
        </select>
      </div>
      <div style="align-self:flex-end;flex:0 0 auto;">
        <button class="btn-secondary btn-small" onclick="loadMatches()">Load</button>
      </div>
    </div>
    <div class="tiny">
      <span class="tag tag-api">Info</span>
      Your API key is visible in the browser. Use only for your own predictions.
      Click a row below to send the match into the Panchapakshi engine.
    </div>
    <table id="matchTable" style="margin-top:6px;display:none;">
      <thead>
      <tr>
        <th>Kickoff (Local)</th>
        <th>Home</th>
        <th>Away</th>
        <th>League</th>
        <th>Country</th>
      </tr>
      </thead>
      <tbody id="matchTbody"></tbody>
    </table>
    <div id="apiStatus" class="tiny"></div>
  </div>

  <!-- MATCH INPUT -->
  <div class="card">
    <div class="card-title">Step 2 · Match Input (auto-filled from API or manual)</div>
    <div class="row">
      <div>
        <label>Home Team</label>
        <input id="homeTeam" placeholder="Home team name" oninput="applyTeamThemes()" />
      </div>
      <div>
        <label>Away Team</label>
        <input id="awayTeam" placeholder="Away team name" oninput="applyTeamThemes()" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>Kickoff Date (venue)</label>
        <input id="matchDate" type="date" />
      </div>
      <div>
        <label>Kickoff Time (venue)</label>
        <input id="kickoffTime" type="time" />
      </div>
      <div>
        <label>Venue Timezone (from API)</label>
        <input id="venueTz" placeholder="Ex: Europe/London" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>League / Competition</label>
        <input id="leagueName" placeholder="Ex: Premier League" />
      </div>
      <div>
        <label>City / Country</label>
        <input id="locationName" placeholder="Ex: Liverpool, England" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>Paksha (auto from date)</label>
        <select id="paksha" onchange="updateDayBird()">
          <option value="shukla">Shukla</option>
          <option value="krishna">Krishna</option>
        </select>
      </div>
      <div>
        <label>Home Team Bird</label>
        <select id="homeBird">
          <option value="">Select bird</option>
          <option>Vulture</option>
          <option>Owl</option>
          <option>Crow</option>
          <option>Cock</option>
          <option>Peacock</option>
        </select>
      </div>
      <div>
        <label>Away Team Bird</label>
        <select id="awayBird">
          <option value="">Select bird</option>
          <option>Vulture</option>
          <option>Owl</option>
          <option>Crow</option>
          <option>Cock</option>
          <option>Peacock</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>&nbsp;</label>
        <button class="btn-secondary" onclick="autoBirdsFromJersey()">Auto birds from jersey / club</button>
      </div>
      <div>
        <label>&nbsp;</label>
        <button class="btn-main" onclick="runPrediction()">Run Panchapakshi Prediction</button>
      </div>
    </div>

    <div id="dayBirdInfo" class="tiny"></div>
    <!-- jersey line hidden as you asked -->
    <div id="jerseyInfo" class="tiny" style="display:none;"></div>
  </div>

  <!-- RESULT -->
  <div id="resultCard" class="card" style="display:none;">
    <div class="card-title">Step 3 · Astro Result</div>
    <div id="winnerLine" class="tiny"></div>
    <div id="probBar"></div>
    <div id="drawLine" class="tiny"></div>
    <div id="extraLine" class="tiny"></div>
  </div>
</div>

<script>
/* ----------------- PANCHAPAKSHI TABLES ----------------- */
const BIRD_PLANETS = {
  shukla: {
    Vulture:['Jupiter','Saturn'],
    Owl:['Sun','Venus'],
    Crow:['Moon'],
    Cock:['Mars'],
    Peacock:['Mercury']
  },
  krishna: {
    Vulture:['Mars'],
    Owl:['Moon'],
    Crow:['Sun'],
    Cock:['Jupiter','Saturn'],
    Peacock:['Mercury','Venus']
  }
};
const BIRDS = ['Vulture','Owl','Crow','Cock','Peacock'];
const DAY_PLANETS = ['Sun','Moon','Mars','Mercury','Jupiter','Venus','Saturn'];

const FRIENDLY_BIRDS = {
  Vulture:['Owl','Cock'],
  Owl:['Vulture','Peacock'],
  Crow:['Peacock','Cock'],
  Cock:['Vulture','Crow'],
  Peacock:['Owl','Crow']
};
const UNFRIENDLY_BIRDS = {
  Vulture:['Peacock','Crow'],
  Owl:['Crow','Cock'],
  Crow:['Vulture','Owl'],
  Cock:['Peacock','Owl'],
  Peacock:['Vulture','Cock']
};

/* Some common football jersey themes (with birds) */
const TEAM_COLOR_RULES = [
  { pattern:/liverpool/i,  bird:'Cock',   color:'#e11d48', label:'Red' },
  { pattern:/manchester city|man city|mancity/i, bird:'Peacock', color:'#38bdf8', label:'Sky Blue' },
  { pattern:/chelsea/i,    bird:'Owl',    color:'#1d4ed8', label:'Blue' },
  { pattern:/arsenal/i,    bird:'Cock',   color:'#dc2626', label:'Red / White' },
  { pattern:/tottenham|spurs/i, bird:'Vulture', color:'#e5e7eb', label:'White / Navy' },
  { pattern:/real madrid/i,bird:'Vulture',color:'#e5e7eb',label:'White' },
  { pattern:/barcelona|barca/i,bird:'Crow',color:'#7c2d12',label:'Maroon / Blue' },
  { pattern:/psg|paris saint/i,bird:'Peacock',color:'#1e3a8a',label:'Navy' },
  { pattern:/juventus|juve/i,bird:'Vulture',color:'#111827',label:'Black / White' },
  { pattern:/milan|ac milan/i,bird:'Cock',color:'#b91c1c',label:'Red / Black' },
  { pattern:/inter/i,bird:'Peacock',color:'#1d4ed8',label:'Blue / Black' },
  { pattern:/bayern|munich/i,bird:'Cock',color:'#dc2626',label:'Red' },
  { pattern:/india/i,bird:'Peacock',color:'#2563eb',label:'Blue' },
  { pattern:/england/i,bird:'Vulture',color:'#e5e7eb',label:'White' },
  { pattern:/brazil/i,bird:'Peacock',color:'#eab308',label:'Yellow / Green' },
  { pattern:/argentina/i,bird:'Peacock',color:'#38bdf8',label:'Sky Blue / White' }
];

function deriveRulingBirds(paksha){
  const map=BIRD_PLANETS[paksha];
  const arr=[];
  for(let d=0;d<7;d++){
    const planet=DAY_PLANETS[d];
    let chosen='Vulture';
    for(const b of BIRDS){
      if((map[b]||[]).includes(planet)){chosen=b;break;}
    }
    arr.push(chosen);
  }
  return arr;
}
const RULING_BIRDS = {
  shukla:deriveRulingBirds('shukla'),
  krishna:deriveRulingBirds('krishna')
};

/* ----------------- BASIC HELPERS ----------------- */
function detectTeamTheme(name,fallbackColor){
  if(!name) return {color:fallbackColor,label:'Default'};
  for(const rule of TEAM_COLOR_RULES){
    if(rule.pattern.test(name)) return {color:rule.color,label:rule.label||'Jersey',bird:rule.bird};
  }
  return {color:fallbackColor,label:'Default'};
}

function applyTeamThemes(){
  const home=document.getElementById('homeTeam').value.trim();
  const away=document.getElementById('awayTeam').value.trim();
  const homeBirdSel=document.getElementById('homeBird');
  const awayBirdSel=document.getElementById('awayBird');

  const homeTheme=detectTeamTheme(home,'#0ea5e9');
  const awayTheme=detectTeamTheme(away,'#22c55e');
  document.documentElement.style.setProperty('--home-main',homeTheme.color);
  document.documentElement.style.setProperty('--away-main',awayTheme.color);

  // auto birds from known clubs
  if(homeTheme.bird && !homeBirdSel.value) homeBirdSel.value=homeTheme.bird;
  if(awayTheme.bird && !awayBirdSel.value) awayBirdSel.value=awayTheme.bird;
}

/* moon age → auto paksha from date */
function computeMoonAge(date){
  const year=date.getUTCFullYear();
  const month=date.getUTCMonth()+1;
  const day=date.getUTCDate();
  let yy = year - Math.floor((12 - month)/10);
  let mm = month + 9;
  if(mm>=12) mm -= 12;
  const k1 = Math.floor(365.25*(yy+4712));
  const k2 = Math.floor(30.6*mm+0.5);
  const k3 = Math.floor(Math.floor((yy/100)+49)*0.75) - 38;
  const jd = k1 + k2 + day + 59 - k3;
  const ip = (jd - 2451550.1)/29.530588853;
  const frac = ip - Math.floor(ip);
  return frac*29.530588853;
}
function autoSetPakshaFromDate(){
  const dateStr=document.getElementById('matchDate').value;
  if(!dateStr) return;
  const d=new Date(dateStr+'T12:00:00');
  const age=computeMoonAge(d);
  const paksha=age<14.765?'shukla':'krishna';
  document.getElementById('paksha').value=paksha;
}

function updateDayBird(){
  const dateStr=document.getElementById('matchDate').value;
  const paksha=document.getElementById('paksha').value;
  const el=document.getElementById('dayBirdInfo');
  if(!dateStr){
    el.innerHTML='Select match date to view ruling bird.';
    return;
  }
  const d=new Date(dateStr+'T12:00:00');
  const idx=d.getDay();
  const ruling=RULING_BIRDS[paksha][idx];
  const friendly=FRIENDLY_BIRDS[ruling]||[];
  const enemy=UNFRIENDLY_BIRDS[ruling]||[];
  el.innerHTML =
    `<span class="tag tag-day">Day Bird</span>`+
    `Ruling bird: <span class="excellent">${ruling}</span> • `+
    `Friendly: <span class="good">${friendly.join(', ')||'-'}</span> • `+
    `Enemy: <span class="danger">${enemy.join(', ')||'-'}</span>`;
}

/* auto birds from jersey button */
function autoBirdsFromJersey(){
  applyTeamThemes();
}

/* ----------------- SIMPLE PANCHAPAKSHI LOGIC (TEAM ONLY) ----------------- */
function scoreBirdVsDay(teamBird,rulingBird,paksha){
  if(!teamBird) return 0;
  let score=0;
  if(teamBird===rulingBird) score+=60;
  const friendly=(FRIENDLY_BIRDS[rulingBird]||[]);
  const enemy=(UNFRIENDLY_BIRDS[rulingBird]||[]);
  if(friendly.includes(teamBird)) score+=30;
  if(enemy.includes(teamBird)) score-=40;

  // small paksha flavour
  if(paksha==='shukla' && (teamBird==='Peacock'||teamBird==='Owl')) score+=10;
  if(paksha==='krishna' && (teamBird==='Vulture'||teamBird==='Crow')) score+=10;
  return score;
}

function runPrediction(){
  const home=document.getElementById('homeTeam').value.trim() || 'Home Team';
  const away=document.getElementById('awayTeam').value.trim() || 'Away Team';
  const dateStr=document.getElementById('matchDate').value;
  const paksha=document.getElementById('paksha').value;
  const homeBird=document.getElementById('homeBird').value;
  const awayBird=document.getElementById('awayBird').value;

  if(!dateStr){alert('Please select match date.');return;}
  if(!homeBird || !awayBird){
    alert('Please select both team birds (auto from jersey is also available).');
    return;
  }

  const d=new Date(dateStr+'T12:00:00');
  const dayIdx=d.getDay();
  const ruling=RULING_BIRDS[paksha][dayIdx];

  const sHome=scoreBirdVsDay(homeBird,ruling,paksha);
  const sAway=scoreBirdVsDay(awayBird,ruling,paksha);

  let adjHome = Math.max(sHome,0);
  let adjAway = Math.max(sAway,0);
  if(adjHome===0 && adjAway===0){adjHome=1;adjAway=1;}

  const total=adjHome+adjAway;
  let pHome=(adjHome/total)*100;
  let pAway=100-pHome;

  // clamp, keep draw zone between 45–55
  const clamp=p=>{
    if(p>75)return 75;
    if(p<25)return 25;
    return p;
  };
  pHome=clamp(pHome);
  pAway=clamp(pAway);

  let winner='Draw / 50-50';
  let drawHint='<span class="draw">Draw zone: very possible if teams are balanced.</span>';
  if(Math.abs(pHome-pAway)>6){
    if(pHome>pAway) winner=home;
    else winner=away;
    drawHint='Draw chance: medium / low (one side has stronger bird energy).';
  }

  const resultCard=document.getElementById('resultCard');
  resultCard.style.display='block';

  document.getElementById('winnerLine').innerHTML =
    `<span class="tag tag-overall">Overall</span>`+
    `Ruling bird for this day: <span class="excellent">${ruling}</span><br>`+
    `Home <span class="team-home">${home}</span> (${homeBird}) vs `+
    `Away <span class="team-away">${away}</span> (${awayBird})<br>`+
    `Predicted winner (Panchapakshi only): <span class="excellent">${winner}</span>`;

  const bar=document.getElementById('probBar');
  bar.innerHTML =
    `<div class="bar-wrap">
       <div class="bar-fill-home" style="width:${pHome}%;"></div>
       <div class="bar-fill-away" style="width:${pAway}%;"></div>
       <div class="bar-label">
         <span class="team-home">${home} ${pHome.toFixed(1)}%</span> ·
         <span class="team-away">${away} ${pAway.toFixed(1)}%</span>
       </div>
     </div>`;

  document.getElementById('drawLine').innerHTML =
    `Draw verdict: <b>${Math.abs(pHome-pAway)<=6 ? 'YES – strong draw region' : 'NO – edge to one side'}</b><br>`+
    drawHint;

  document.getElementById('extraLine').innerHTML =
    `Rule-lock: <b>Pure Panchapakshi</b> (Day ruler + Team bird + Friendly / Enemy).<br>`+
    `Numerology / goal-time are NOT used in this version.`;
}

/* ----------------- API-FOOTBALL ----------------- */
async function loadMatches(){
  const key=document.getElementById('apiKey').value.trim();
  const filter=document.getElementById('apiFilter').value;
  const status=document.getElementById('apiStatus');
  const tbody=document.getElementById('matchTbody');
  const table=document.getElementById('matchTable');
  tbody.innerHTML='';
  table.style.display='none';
  if(!key){
    status.innerHTML='<span class="danger">Enter your API key first.</span>';
    return;
  }
  let url='https://v3.football.api-sports.io/fixtures';
  if(filter==='live') url+='?live=all';        // live matches only
  else url+='?next=20';                        // upcoming only

  status.innerHTML='Loading from API…';

  try{
    const res=await fetch(url,{
      headers:{'x-apisports-key':key}
    });
    const data=await res.json();
    if(!data.response || !data.response.length){
      status.innerHTML='No matches found for this filter.';
      return;
    }
    data.response.forEach(fix=>{
      const f=fix.fixture;
      const h=fix.teams.home;
      const a=fix.teams.away;
      const league=fix.league;
      const localTime=new Date(f.date);
      const displayTime = localTime.toLocaleString('en-GB',{
        hour:'2-digit',minute:'2-digit',
        day:'2-digit',month:'short'
      });
      const tr=document.createElement('tr');
      tr.innerHTML =
        `<td>${displayTime}</td>
         <td>${h.name}</td>
         <td>${a.name}</td>
         <td>${league.name}</td>
         <td>${league.country}</td>`;
      tr.onclick=()=>applyFixture(fix);
      tbody.appendChild(tr);
    });
    table.style.display='table';
    status.innerHTML=
      `Loaded ${data.response.length} matches. Click a row to send it to the predictor.`;
  }catch(e){
    console.error(e);
    status.innerHTML='<span class="danger">API error. Check key / network / quota.</span>';
  }
}

function applyFixture(fix){
  const f=fix.fixture;
  const h=fix.teams.home;
  const a=fix.teams.away;
  const league=fix.league;

  const dt=new Date(f.date);
  const isoDate=dt.toISOString().slice(0,10);
  const hh=dt.getHours().toString().padStart(2,'0');
  const mm=dt.getMinutes().toString().padStart(2,'0');

  document.getElementById('homeTeam').value=h.name;
  document.getElementById('awayTeam').value=a.name;
  document.getElementById('matchDate').value=isoDate;
  document.getElementById('kickoffTime').value=`${hh}:${mm}`;
  document.getElementById('venueTz').value=f.timezone || '';
  document.getElementById('leagueName').value=league.name;
  document.getElementById('locationName').value=(f.venue?.city||'')+
    (league.country ? `, ${league.country}` : '');

  applyTeamThemes();           // sets colours & auto birds
  autoSetPakshaFromDate();     // auto Shukla/Krishna
  updateDayBird();             // show ruling bird
}

/* --------- INIT --------- */
(function init(){
  const today=new Date();
  document.getElementById('matchDate').value=today.toISOString().slice(0,10);
  autoSetPakshaFromDate();
  applyTeamThemes();
  updateDayBird();

  document.getElementById('matchDate')
    .addEventListener('change',()=>{autoSetPakshaFromDate();updateDayBird();});
})();
</script>
</body>
</html>
