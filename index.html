<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Astro Football â€¢ Panchapakshi API</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <style>
    :root{
      --home-main:#0ea5e9;
      --away-main:#22c55e;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:#ffffff;
      color:#111827;
    }
    .wrap{
      max-width:960px;
      margin:0 auto;
      padding:14px;
    }
    h1{
      font-size:18px;
      text-transform:uppercase;
      letter-spacing:0.28em;
      color:#111827;
      text-align:center;
      margin:6px 0 2px;
    }
    .subtitle{
      text-align:center;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.22em;
      color:#6b7280;
      margin-bottom:12px;
    }

    .card{
      background:#f9fafb;
      border:1px solid #e5e7eb;
      border-radius:16px;
      padding:12px;
      margin-bottom:14px;
      box-shadow:0 10px 24px rgba(15,23,42,0.06);
    }

    .title-sm{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.22em;
      color:#6b7280;
      margin-bottom:8px;
    }

    label{
      display:block;
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.18em;
      color:#9ca3af;
      margin-bottom:3px;
    }
    input,select{
      width:100%;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #d1d5db;
      background:#ffffff;
      color:#111827;
      font-size:13px;
      margin-bottom:10px;
    }
    input:focus,select:focus{
      outline:none;
      border-color:#0ea5e9;
      box-shadow:0 0 0 1px #0ea5e9;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .row>div{
      flex:1;
      min-width:140px;
    }

    button{
      width:100%;
      padding:9px;
      border:none;
      border-radius:999px;
      text-transform:uppercase;
      letter-spacing:0.18em;
      font-size:11px;
      font-weight:600;
      color:#ffffff;
      cursor:pointer;
      margin-bottom:4px;
    }
    .btn-main{
      background:linear-gradient(90deg,#2563eb,#22c55e);
      box-shadow:0 8px 18px rgba(37,99,235,0.35);
    }
    .btn-dark{
      background:linear-gradient(90deg,#111827,#4b5563);
      box-shadow:0 8px 18px rgba(17,24,39,0.35);
    }
    .btn-ghost{
      background:#e5e7eb;
      color:#111827;
      box-shadow:none;
    }
    button:active{transform:scale(.97);}

    .tiny{
      font-size:11px;
      color:#6b7280;
      margin-top:4px;
      line-height:1.6;
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:11px;
      margin-top:4px;
    }
    th,td{
      border:1px solid #e5e7eb;
      padding:4px 6px;
      text-align:left;
      white-space:nowrap;
    }
    th{
      background:#e5f3ff;
      color:#374151;
      text-transform:uppercase;
      letter-spacing:0.08em;
      font-size:10px;
    }
    tr:nth-child(even){background:#ffffff;}
    tr:nth-child(odd){background:#f9fafb;}
    tr:hover{background:#e0f2fe;cursor:pointer;}

    .status-live{
      color:#dc2626;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:4px;
    }
    .live-dot{
      width:8px;
      height:8px;
      border-radius:50%;
      background:#ef4444;
      box-shadow:0 0 0 3px rgba(248,113,113,0.4);
    }

    .err{
      color:#b91c1c;
      font-size:11px;
      margin-top:4px;
      white-space:pre-line;
    }

    .tag{
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.12em;
      font-size:10px;
      padding:2px 8px;
      border-radius:999px;
      display:inline-block;
      margin-right:6px;
    }
    .tag-day{background:#dbeafe;color:#1d4ed8;}
    .tag-flow{background:#e0f2fe;color:#075985;}
    .tag-overall{background:#fee2a7;color:#92400e;}
    .tag-score{background:#dcfce7;color:#166534;}
    .tag-draw{background:#fee2e2;color:#b91c1c;}

    .home-text{color:var(--home-main);font-weight:600;}
    .away-text{color:var(--away-main);font-weight:600;}
    .good-text{color:#22c55e;font-weight:600;}
    .weak-text{color:#ef4444;font-weight:600;}
    .excellent-text{color:#15803d;font-weight:700;}

    .bar-wrap{
      width:100%;
      height:14px;
      border-radius:999px;
      overflow:hidden;
      background:#e5e7eb;
      border:1px solid #d1d5db;
      margin:6px 0 4px 0;
      display:flex;
      position:relative;
    }
    .bar-fill{height:100%;}
    .bar-home{background:linear-gradient(90deg,var(--home-main),#38bdf8);}
    .bar-away{background:linear-gradient(90deg,var(--away-main),#22c55e);}
    .bar-label{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      font-size:10px;
      font-weight:600;
      white-space:nowrap;
      color:#ffffff;
      text-shadow:0 1px 2px rgba(0,0,0,0.6);
    }

    .summary-line{
      font-size:11.5px;
      margin:1px 0;
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>ASTRO FOOTBALL</h1>
  <div class="subtitle">Pure Panchapakshi Â· Football Only Â· API Mode</div>

  <!-- STEP 1 â€“ API FOOTBALL -->
  <div class="card">
    <div class="title-sm">Step 1 Â· Load Football Matches (API-FOOTBALL)</div>

    <div class="row">
      <div>
        <label>API key (dashboard.api-football.com)</label>
        <input id="apiKey" placeholder="Paste your API key only" />
      </div>
      <div>
        <label>Day</label>
        <input id="dateFilter" type="date" />
      </div>
      <div style="flex:0 0 130px;align-self:flex-end;">
        <button id="btnLoad" class="btn-main">LOAD MATCHES</button>
      </div>
    </div>

    <div id="apiStatus" class="tiny">
      Paste your key â†’ choose date â†’ LOAD.  
      Live + upcoming only (finished matches are hidden). Click any row to send match into Step 2.
    </div>
    <div id="apiError" class="err"></div>

    <div style="margin-top:8px;max-height:320px;overflow:auto;border-radius:12px;border:1px solid #e5e7eb;">
      <table>
        <thead>
          <tr>
            <th>Kickoff (UTC)</th>
            <th>Home</th>
            <th>Away</th>
            <th>League</th>
            <th>City / Country</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="matchesBody">
          <tr><td colspan="6" style="text-align:center;color:#9ca3af;">No data yet.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- STEP 2 â€“ MATCH INPUT -->
  <div class="card">
    <div class="title-sm">Step 2 Â· Match Input (from API row or manual)</div>

    <div class="row">
      <div>
        <label>Home team</label>
        <input id="homeTeam" placeholder="Home team name" />
      </div>
      <div>
        <label>Away team</label>
        <input id="awayTeam" placeholder="Away team name" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>Kickoff date (venue)</label>
        <input id="kickoffDate" type="date" />
      </div>
      <div>
        <label>Kickoff time (venue)</label>
        <input id="kickoffTime" type="time" value="20:00" />
      </div>
      <div>
        <label>Venue timezone (from API)</label>
        <input id="venueTz" placeholder="Ex: Europe/London" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>League / competition</label>
        <input id="league" placeholder="Ex: Premier League" />
      </div>
      <div>
        <label>City / Country</label>
        <input id="city" placeholder="Ex: Liverpool, England" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>Paksha (auto from date)</label>
        <select id="paksha" disabled>
          <option value="shukla">Shukla</option>
          <option value="krishna">Krishna</option>
        </select>
      </div>
      <div style="flex:1.5;align-self:flex-end;">
        <button id="btnAutoBirds" class="btn-dark">
          Auto team birds from name (LOCK)
        </button>
      </div>
    </div>

    <div class="tiny" id="dayInfo"></div>
    <div class="tiny" id="teamBirdInfo"></div>
  </div>

  <!-- STEP 3 â€“ PANCHAPAKSHI PREDICTION -->
  <div class="card">
    <div class="title-sm">Step 3 Â· Pure Panchapakshi Prediction</div>
    <button id="btnPredict" class="btn-main">RUN PANCHAPAKSHI PREDICTION</button>
    <div class="tiny" id="waitLine">Waiting for match inputâ€¦</div>
    <div id="summaryBox" style="margin-top:8px;"></div>
  </div>
</div>

<script>
/* ---------- Shortcuts ---------- */
const $ = id => document.getElementById(id);

/* ---------- Panchapakshi base tables ---------- */
const BIRDS = ['Vulture','Owl','Crow','Cock','Peacock'];
const DAY_PLANETS = ['Sun','Moon','Mars','Mercury','Jupiter','Venus','Saturn'];

const BIRD_PLANETS = {
  shukla: {
    Vulture:['Jupiter','Saturn'],
    Owl:['Sun','Venus'],
    Crow:['Moon'],
    Cock:['Mars'],
    Peacock:['Mercury']
  },
  krishna: {
    Vulture:['Mars'],
    Owl:['Moon'],
    Crow:['Sun'],
    Cock:['Jupiter','Saturn'],
    Peacock:['Mercury','Venus']
  }
};

function deriveRulingBirds(paksha){
  const map=BIRD_PLANETS[paksha];
  const arr=[];
  for(let d=0;d<7;d++){
    const planet=DAY_PLANETS[d];
    let chosen='Vulture';
    for(const bird of BIRDS){
      const list=map[bird]||[];
      if(list.includes(planet)){chosen=bird;break;}
    }
    arr.push(chosen);
  }
  return arr;
}
const RULING_BIRDS = {
  shukla:deriveRulingBirds('shukla'),
  krishna:deriveRulingBirds('krishna')
};

const FRIENDLY_BIRDS = {
  Vulture:['Owl','Cock'],
  Owl:['Vulture','Peacock'],
  Crow:['Peacock','Cock'],
  Cock:['Vulture','Crow'],
  Peacock:['Owl','Crow']
};
const UNFRIENDLY_BIRDS = {
  Vulture:['Peacock','Crow'],
  Owl:['Crow','Cock'],
  Crow:['Vulture','Owl'],
  Cock:['Peacock','Owl'],
  Peacock:['Vulture','Cock']
};

/* 27 nakshatra â†’ bird (1..27) */
const NAK_BIRDS = [
  'Peacock','Peacock','Peacock','Peacock','Peacock',
  'Cock','Cock','Cock','Cock','Cock','Cock',
  'Crow','Crow','Crow','Crow','Crow',
  'Owl','Owl','Owl','Owl','Owl',
  'Vulture','Vulture','Vulture','Vulture','Vulture','Vulture'
];

/* Activity values: Rule=100, Eat=80, Walk=50, Sleep=30, Die=0 */
const ACTIVITY_SCORES = {Rule:100,Eat:80,Walk:50,Sleep:30,Die:0};
const APAHARA_DUR = {Rule:48,Eat:30,Walk:36,Sleep:18,Die:12};
const ACTIVITY_CYCLES = {
  shukla_day:['Eat','Walk','Rule','Sleep','Die'],
  shukla_night:['Eat','Rule','Die','Walk','Sleep'],
  krishna_day:['Eat','Die','Sleep','Rule','Walk'],
  krishna_night:['Eat','Sleep','Walk','Die','Rule']
};

/* ---------- Moon age â†’ Paksha ---------- */
function computeMoonAge(date){
  const year=date.getUTCFullYear();
  const month=date.getUTCMonth()+1;
  const day=date.getUTCDate();
  let yy=year-Math.floor((12-month)/10);
  let mm=month+9;
  if(mm>=12)mm-=12;
  const k1=Math.floor(365.25*(yy+4712));
  const k2=Math.floor(30.6*mm+0.5);
  const k3=Math.floor(Math.floor((yy/100)+49)*0.75)-38;
  const jd=k1+k2+day+59-k3;
  const ip=(jd-2451550.1)/29.530588853;
  const frac=ip-Math.floor(ip);
  return frac*29.530588853;
}
function autoPakshaFromDate(iso){
  const d=new Date(iso);
  if(isNaN(d)) return 'shukla';
  const age=computeMoonAge(d);
  return age<14.765?'shukla':'krishna';
}

/* ---------- Helpers ---------- */
function timeToMins(t){
  if(!t)return 0;
  const [h,m]=t.split(':').map(Number);
  return h*60+m;
}

/* main yama & segments */
function getMainYamaContext(bird,timeMins,dayIdx,pakshaType){
  const dayStart=360,nightStart=1080,yamaDur=144;
  let t=timeMins;
  if(t<dayStart)t+=1440;
  let isNight,minsSince,cycleStart;
  if(t>=dayStart && t<nightStart){
    isNight=false;
    minsSince=t-dayStart;
    cycleStart=dayStart;
  }else{
    isNight=true;
    if(t>=nightStart){
      minsSince=t-nightStart;
      cycleStart=nightStart;
    }else{
      minsSince=(t+1440)-nightStart;
      cycleStart=nightStart;
    }
  }
  const idx=Math.floor(minsSince/yamaDur);
  const clamped=Math.min(idx,4);
  const key=pakshaType+'_'+(isNight?'night':'day');
  const cycle=ACTIVITY_CYCLES[key];
  const ruling=RULING_BIRDS[pakshaType][dayIdx];
  const bi=BIRDS.indexOf(bird);
  const ri=BIRDS.indexOf(ruling);
  const dist=(bi-ri+5)%5;
  const actIndex=(clamped+dist)%5;
  const mainAct=cycle[actIndex];
  const yamaStart=cycleStart+clamped*yamaDur;
  return {mainAct,yamaStart,cycle};
}

function generateSegments(bird,startMins,endMins,dayIdx,pakshaType){
  let segs=[];
  let cur=startMins;
  while(cur<endMins){
    const {mainAct,yamaStart,cycle}=getMainYamaContext(bird,cur%1440,dayIdx,pakshaType);
    const mainIdx=cycle.indexOf(mainAct);
    const order=['Rule','Eat','Walk','Sleep','Die'];
    let subStart=yamaStart;
    let subList=[];
    for(const act of order){
      const dur=APAHARA_DUR[act];
      subList.push({activity:act,start:subStart,end:subStart+dur,score:ACTIVITY_SCORES[act]});
      subStart+=dur;
    }
    for(const s of subList){
      const effStart=Math.max(cur,s.start);
      const effEnd=Math.min(endMins,s.end);
      if(effEnd>effStart){
        segs.push({
          startMins:effStart,
          endMins:effEnd,
          activity:s.activity,
          score:s.score,
          duration:effEnd-effStart
        });
        cur=effEnd;
      }
    }
    if(cur>=endMins)break;
    if(cur<yamaStart+144)cur=yamaStart+144;
  }
  return segs;
}

function calcEnvPercent(homeBird,awayBird,dateIso,timeStr,paksha){
  const d=new Date(dateIso);
  if(isNaN(d)) return {home:50,away:50};
  const dayIdx=d.getDay();
  const start=timeToMins(timeStr||'20:00');
  const end=start+120;
  const segH=generateSegments(homeBird,start,end,dayIdx,paksha);
  const segA=generateSegments(awayBird,start,end,dayIdx,paksha);

  let pts=new Set([start,end]);
  segH.forEach(s=>{pts.add(s.startMins);pts.add(s.endMins);});
  segA.forEach(s=>{pts.add(s.startMins);pts.add(s.endMins);});
  const sorted=[...pts].sort((a,b)=>a-b);

  let totDur=0,accH=0;
  for(let i=0;i<sorted.length-1;i++){
    const a=sorted[i],b=sorted[i+1],dur=b-a;
    const h=segH.find(s=>s.startMins<=a && s.endMins>=b);
    const aw=segA.find(s=>s.startMins<=a && s.endMins>=b);
    if(h&&aw){
      const tot=h.score+aw.score;
      const pH=tot>0?(h.score/tot)*100:50;
      accH+=pH*dur;
      totDur+=dur;
    }
  }
  if(!totDur)return {home:50,away:50};
  const home=accH/totDur;
  return {home,away:100-home};
}

/* ---------- Numerology â†’ 27 nak â†’ bird ---------- */
function nameToNakIndex(name){
  const clean=name.toUpperCase().replace(/[^A-Z]/g,'');
  if(!clean)return 0;
  let sum=0;
  for(const c of clean){
    const n=c.charCodeAt(0)-64; // A=1
    sum += ((n-1)%9)+1;
  }
  return (sum-1)%27; // 0..26
}
function teamNameToBird(name){
  const idx=nameToNakIndex(name);
  return NAK_BIRDS[idx] || 'Vulture';
}

/* ---------- Day info UI ---------- */
function updateDayInfo(){
  const date=$('kickoffDate').value;
  if(!date){
    $('dayInfo').textContent='Set kickoff date to see day ruling bird.';
    return;
  }
  const paksha=$('paksha').value;
  const d=new Date(date);
  const dayIdx=d.getDay();
  const dayBird=RULING_BIRDS[paksha][dayIdx];
  const fr=FRIENDLY_BIRDS[dayBird]||[];
  const en=UNFRIENDLY_BIRDS[dayBird]||[];
  const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

  $('dayInfo').innerHTML =
    `<span class="tag tag-day">Day Bird</span>`+
    `${days[dayIdx]} Â· Paksha: ${paksha==='shukla'?'Shukla':'Krishna'} Â· `+
    `Ruling bird: <span class="excellent-text">${dayBird}</span> Â· `+
    `Friendly: <span class="good-text">${fr.join(', ')||'-'}</span> Â· `+
    `Enemy: <span class="weak-text">${en.join(', ')||'-'}</span>`;
}

/* ---------- Auto team birds (lock) ---------- */
let homeBirdLocked=null;
let awayBirdLocked=null;

function autoTeamBirds(){
  const home=$('homeTeam').value.trim();
  const away=$('awayTeam').value.trim();
  if(!home || !away){
    alert('Enter both team names first.');
    return;
  }
  homeBirdLocked=teamNameToBird(home);
  awayBirdLocked=teamNameToBird(away);
  $('teamBirdInfo').innerHTML =
    `Team birds (locked): `+
    `<span class="home-text">${home}</span> â†’ <b>${homeBirdLocked}</b> Â· `+
    `<span class="away-text">${away}</span> â†’ <b>${awayBirdLocked}</b><br>`+
    `<span style="font-size:10px;">(Name â†’ numerology â†’ 27 nakshatra â†’ bird. Manual change not allowed ðŸ”’)</span>`;
}

/* ---------- Match bar ---------- */
function makeBar(homePct,awayPct,homeLabel,awayLabel){
  return `
    <div class="bar-wrap">
      <div class="bar-fill bar-home" style="width:${homePct}%;"></div>
      <div class="bar-fill bar-away" style="width:${awayPct}%;"></div>
      <div class="bar-label">
        <span class="home-text">${homeLabel}</span> â€¢
        <span class="away-text">${awayLabel}</span>
      </div>
    </div>`;
}

/* ---------- Prediction ---------- */
function runPrediction(){
  const home=$('homeTeam').value.trim();
  const away=$('awayTeam').value.trim();
  const date=$('kickoffDate').value;
  const time=$('kickoffTime').value||'20:00';

  if(!home || !away || !date){
    alert('Fill home team, away team, date & time first.');
    return;
  }
  if(!homeBirdLocked || !awayBirdLocked){
    autoTeamBirds();
  }
  updateDayInfo();
  const paksha=$('paksha').value;

  // environment %
  const env=calcEnvPercent(homeBirdLocked,awayBirdLocked,date,time,paksha);
  let homePct=env.home;
  let awayPct=env.away;

  // clamp 30â€“70 lock
  const clamp=p=>p>70?70:p<30?30:p;
  homePct=clamp(homePct);
  awayPct=100-homePct;

  const diff=homePct-awayPct;

  const drawLikely=Math.abs(diff)<=7;
  const drawText=drawLikely
    ? 'YES â€“ energies nearly equal.'
    : (Math.abs(diff)<=10
        ? 'MAYBE â€“ still tight match.'
        : 'NO â€“ one bird clearly stronger.');

  let winner='Balanced / 50-50';
  if(diff>2)winner=home;
  else if(diff<-2)winner=away;

  let scoreHint='';
  if(drawLikely){
    scoreHint='1â€“1 or 2â€“2 (draw side strong).';
  }else if(diff>10){
    scoreHint='Home win: 2â€“0 or 3â€“1.';
  }else if(diff>2){
    scoreHint='Home edge: 1â€“0 or 2â€“1.';
  }else if(diff<-10){
    scoreHint='Away win: 0â€“2 or 1â€“3.';
  }else if(diff<-2){
    scoreHint='Away edge: 0â€“1 or 1â€“2.';
  }else{
    scoreHint='Score tight â€“ use flow % and in-play feel.';
  }

  const envBar=makeBar(
    homePct,
    awayPct,
    `${home} ${homePct.toFixed(1)}%`,
    `${away} ${awayPct.toFixed(1)}%`
  );

  const homeClass=winner===home?'excellent-text':winner===away?'weak-text':'home-text';
  const awayClass=winner===away?'excellent-text':winner===home?'weak-text':'away-text';

  $('waitLine').style.display='none';
  $('summaryBox').innerHTML =
    `<div class="summary-line">
       <span class="tag tag-flow">Team Birds</span>
       <span class="home-text">${home}</span> â†’ <b>${homeBirdLocked}</b> Â·
       <span class="away-text">${away}</span> â†’ <b>${awayBirdLocked}</b>
     </div>
     <div class="summary-line">
       <span class="tag tag-flow">Match Flow (Panchapakshi)</span>
       ${envBar}
     </div>
     <div class="summary-line">
       <span class="tag tag-draw">Draw?</span>
       <b>${drawText}</b>
     </div>
     <div class="summary-line">
       <span class="tag tag-score">Correct Score Hint</span>
       <b>${scoreHint}</b><br>
       Rule = 100 Â· Eat = 80 Â· Walk = 50 Â· Sleep = 30 Â· Die = 0 (engine lock).
     </div>
     <div class="summary-line">
       <span class="tag tag-overall">Overall Winner</span>
       <span class="${homeClass}">${home}</span> ${homePct.toFixed(1)}% Â·
       <span class="${awayClass}">${away}</span> ${awayPct.toFixed(1)}%<br>
       Final call: <span class="excellent-text">${winner}</span>
     </div>`;
}

/* ---------- API: Load fixtures ---------- */
async function loadMatches(){
  const key=$('apiKey').value.trim();
  const date=$('dateFilter').value;
  const body=$('matchesBody');
  $('apiError').textContent='';

  if(!key){
    alert('Paste API key first.');
    return;
  }
  if(!date){
    alert('Choose date.');
    return;
  }

  body.innerHTML='<tr><td colspan="6" style="text-align:center;color:#9ca3af;">Loadingâ€¦</td></tr>';
  $('apiStatus').style.color='#6b7280';
  $('apiStatus').textContent='Calling API-FOOTBALL fixturesâ€¦';

  const url=`https://v3.football.api-sports.io/fixtures?date=${date}&timezone=UTC`;

  try{
    const res=await fetch(url,{
      method:'GET',
      headers:{'x-apisports-key':key}
    });

    let errorMsg='';
    if(!res.ok){
      errorMsg += `HTTP ${res.status}\n`;
      try{
        const errJson=await res.json();
        if(errJson && errJson.errors && Object.keys(errJson.errors).length){
          errorMsg += Object.values(errJson.errors).join(' / ');
        }else if(errJson && errJson.message){
          errorMsg += errJson.message;
        }
      }catch(e){}
      throw new Error(errorMsg || ('HTTP '+res.status));
    }

    const data=await res.json();
    const fixtures=data.response || [];
    const finishedCodes=['FT','AET','PEN','CANC','ABD','AWD','WO','PST'];

    body.innerHTML='';
    let count=0;

    fixtures.forEach(f =>{
      const st=f.fixture.status?.short || '';
      if(finishedCodes.includes(st)) return; // hide finished

      count++;
      const dIso=f.fixture.date;
      const dObj=new Date(dIso);
      const dateStr=dObj.toISOString().slice(0,10);
      const timeStr=dObj.toISOString().slice(11,16);

      const home=f.teams.home.name;
      const away=f.teams.away.name;
      const league=f.league.name || '';
      const city=f.fixture.venue.city || '';
      const country=f.league.country || '';

      const statusShort=st || 'NS';
      const isLive=['1H','2H','ET','P','BT','HT'].includes(statusShort);

      const tr=document.createElement('tr');
      tr.innerHTML=
        `<td>${dateStr} ${timeStr}</td>
         <td>${home}</td>
         <td>${away}</td>
         <td>${league}</td>
         <td>${city || country}</td>
         <td>${isLive ? '<span class="status-live"><span class="live-dot"></span>LIVE</span>' : statusShort}</td>`;

      tr.addEventListener('click',()=>{
        $('homeTeam').value=home;
        $('awayTeam').value=away;
        $('kickoffDate').value=dateStr;
        $('kickoffTime').value=timeStr;
        $('venueTz').value=f.fixture.timezone || 'UTC';
        $('league').value=league;
        $('city').value=city || country;

        const p=autoPakshaFromDate(dateStr);
        $('paksha').value=p;
        updateDayInfo();
        autoTeamBirds();
        window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
      });

      body.appendChild(tr);
    });

    if(!count){
      body.innerHTML='<tr><td colspan="6" style="text-align:center;color:#9ca3af;">No live/upcoming fixtures returned for this date (maybe only finished matches).</td></tr>';
    }

    $('apiStatus').style.color='#16a34a';
    $('apiStatus').textContent='API call success. Click any row to send into Step 2.';

  }catch(err){
    console.error(err);
    $('apiError').textContent=
      'API error:\n'+err.message+
      '\n\nCheck in dashboard.api-football.com â†’ My Access:\n' +
      'â€¢ Key correct\n' +
      'â€¢ Daily quota not 0\n' +
      'â€¢ If still same, this is API-side, not HTML.';
    $('apiStatus').style.color='#b91c1c';
    $('apiStatus').textContent='API error â€“ see red message below.';
    body.innerHTML='<tr><td colspan="6" style="text-align:center;color:#9ca3af;">No data â€“ API error.</td></tr>';
  }
}

/* ---------- INIT ---------- */
(function init(){
  const today=new Date().toISOString().slice(0,10);
  $('dateFilter').value=today;
  $('kickoffDate').value=today;

  const p=autoPakshaFromDate(today);
  $('paksha').value=p;
  updateDayInfo();

  $('kickoffDate').addEventListener('change',()=>{
    const d=$('kickoffDate').value;
    const pk=autoPakshaFromDate(d);
    $('paksha').value=pk;
    updateDayInfo();
  });

  $('btnLoad').addEventListener('click',loadMatches);
  $('btnAutoBirds').addEventListener('click',e=>{e.preventDefault();autoTeamBirds();});
  $('btnPredict').addEventListener('click',e=>{e.preventDefault();runPrediction();});
})();
</script>
</body>
</html>
